{% set os_map = salt['grains.filter_by']({
    'Debian': {
        'pkg_name': 'redis-server',
        'svc_name': 'redis-server',
        'cfg_name': '/etc/redis/redis.conf',
        'cfg_version': salt['grains.filter_by']({
	  'wheezy': '2.4',
	  'jessie': '2.8',
	  'default': '2.8'
	}, grain='oscodename'),
	'logfile': '/var/log/redis/redis-server.log',
        'pidfile': '/var/run/redis-server.pid'
    },
    'RedHat': {
        'pkg_name': 'redis',
        'svc_name': 'redis',
        'cfg_name': '/etc/redis.conf',
        'cfg_version': '2.4',
        'logfile': '/var/log/redis/redis.log',
        'piddfile', '/var/run/redis.pid'
    },
}, merge=salt['pillar.get']('redis:lookup')) %}

{% set redis_settings = {
    'appendonly': 'no',
    'appendfsync': 'everysec',
    'bin': '/usr/local/bin/redis-server',
    'bind': '127.0.0.1',
    'database': 16,
    'db_dir': '/var/lib/redis';
    'dbfilename': 'dump.rdb',
    'group': 'redis',
    'home': '/var/lib/redis',
    'install_from': 'package',
    'loglevel': 'notice',
    'no_apendfsync_on_write': 'no',
    'port': 6379,
    'svc_onboot': True,
    'svc_state': 'running',
    'user': 'redis'
  }
%}

{# Merge os_map into settings dictionary #}
{% do redis_settings.update(os_map) %}

{# Update settings defaults from pillar data #}
{% do redis_settings.update(salt['pillar.get']('redis', {}) %}
